<title>陀螺景品⬧Prizes</title>
<script src=../include/common.js></script>
<script src=https://aeoq.github.io/diamond-grid/script.js type=module></script>
<link rel=stylesheet href=prize.css>

<nav>
    <menu>
        <li><a href="../products/" data-icon=""></a>
        <li><a href="../parts/?blade" data-icon=""></a>
    </menu>
    <form class="LED">
        <a href="https://beyblade.takaratomy.co.jp/beyblade-x/news/news_stickerlist.html">
            <img src="https://beyblade.takaratomy.co.jp/beyblade-x/news/_image/news_stickerlist_12.png">
            <span>各款貼紙</span>
        </a>
    </form>
</nav>

<main>
    <diamond-grid></diamond-grid>
</main>

<script type="module">
import { Bey } from '../include/bey.js'
import { Keihin } from '../include/utilities.js'

const Prize = () => Prize.before().then(Prize.display).then(Prize.after);
Object.assign(Prize, {
    before: () => Promise.all([DB.get.essentials(), fetch('../db/prod-keihin.json')])
        .then(([[meta, parts], resp]) => Bey.import(meta.general, parts) && resp.json()),

    display: keihins => Q('diamond-grid').append(...Prize.all = keihins.map(k => new Keihin(k))),
    after: () => [Prize.filter(), Prize.event()],
    
    filter: () => Q('nav form').append(...E.checkboxes(Object.keys(Keihin.type).map(t => ({id: `keihin-${t}`, checked: true}) ))),
    event () {
        Q('nav').onchange = () => {
            let show = Q('nav input', []).filter(i => i.checked).map(i => i.id);
            Prize.all.forEach(k => k.hidden = !show.includes(k.classList[0]));
        };
        onclick = ev => {
            let h4 = ev.target.closest('h4')?.cloneNode(true);
            if (!h4) return;
            h4.Q('.code')?.remove();
            navigator.clipboard.writeText([...h4.children].map(el => el.innerText.replace(' ', '')).join(' '));
        }
    }
});
Q('main').prepend(DB().then(Prize));
</script>
